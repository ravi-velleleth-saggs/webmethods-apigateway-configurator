---

vars_apigw_keystores_enabled: "{{ lookup('env', 'apigw_settings_keystores_configure') | default('false',true) }}"
vars_apigw_keystores_ignore_errors: "{{ lookup('env', 'apigw_settings_keystores_configure_ignore_errors') | default(vars_apigw_default_ignore_errors,true) }}"

vars_apigw_truststores_enabled: "{{ lookup('env', 'apigw_settings_truststores_configure') | default('false',true) }}"
vars_apigw_truststores_ignore_errors: "{{ lookup('env', 'apigw_settings_truststores_configure_ignore_errors') | default(vars_apigw_default_ignore_errors,true) }}"

## apigateway keystore details
_apigw_keystores_indices_finder_prefix: "apigw_settings_keystores_"
_apigw_keystores_indices_finder_suffix: "_name"
_index_items_regex_pattern: "{{ common_index_items_regex_pattern | format( _apigw_keystores_indices_finder_prefix, _apigw_keystores_indices_finder_suffix) }}"

_apigw_keystores_template_filepath: "{{ lookup('env', 'apigw_settings_keystores_%s_filepath' | format(index_item)) | default('',true) }}"
_apigw_keystores_template_filename: "{{ _apigw_keystores_template_filepath | basename }}"

# IMPORTANT: if isPwdBase64Encoded=true, all password MUST be encoded or it will error out
# also, for pkPasswordsList, each password in the comma-separated list would need to be encoded 
# TODO: --> need to post process this -- in the meantime, let's set isPwdBase64Encoded=false for now
_apigw_keystores_template:
  keyStoreName: "{{ lookup('env', 'apigw_settings_keystores_%s_name' | format(index_item)) | default('',true) }}"
  keyStoreDescription: "{{ lookup('env', 'apigw_settings_keystores_%s_description' | format(index_item)) | default('',true) }}"
  keyStoreType: "{{ lookup('env', 'apigw_settings_keystores_%s_type' | format(index_item)) | default('',true) }}"
  keyStoreProvider: "{{ lookup('env', 'apigw_settings_keystores_%s_provider' | format(index_item)) | default('',true) }}"
  keyStorePassword: "{{ lookup('env', 'apigw_settings_keystores_%s_password' | format(index_item)) | default('',true) }}"
  uploadFileName: "{{ _apigw_keystores_template_filename }}"
  fileContent: "@{{ _apigw_keystores_template_filepath }}"
  pkAliasesList: "{{ lookup('env', 'apigw_settings_keystores_%s_aliases' | format(index_item)) | default('',true) }}"
  pkPasswordsList: "{{ lookup('env', 'apigw_settings_keystores_%s_aliasesPasswords' | format(index_item)) | default('',true) }}"
  nullPKpasswds: "{{ lookup('env', 'apigw_settings_keystores_%s_aliasesPasswordsNull' | format(index_item)) | default('',true) }}"
  isPwdBase64Encoded: "false"

## apigateway truststore details
_apigw_truststores_indices_finder_prefix: "apigw_settings_truststores_"
_apigw_truststores_indices_finder_suffix: "_name"

_apigw_truststores_template_filepath: "{{ lookup('env', 'apigw_settings_truststores_%s_filepath' | format(index_item)) | default('',true) }}"
_apigw_truststores_template_filename: "{{ _apigw_truststores_template_filepath | basename }}"
_apigw_truststores_template:
  keyStoreName: "{{ lookup('env', 'apigw_settings_truststores_%s_name' | format(index_item)) | default('',true) }}"
  keyStoreDescription: "{{ lookup('env', 'apigw_settings_truststores_%s_description' | format(index_item)) | default('',true) }}"
  keyStoreType: "{{ lookup('env', 'apigw_settings_truststores_%s_type' | format(index_item)) | default('',true) }}"
  keyStoreProvider: "{{ lookup('env', 'apigw_settings_truststores_%s_provider' | format(index_item)) | default('',true) }}"
  keyStorePassword: "{{ lookup('env', 'apigw_settings_truststores_%s_password' | format(index_item)) | default('',true) | b64encode }}"
  isPwdBase64Encoded: "true"
  uploadFileName: "{{ _apigw_truststores_template_filename }}"
  fileContent: "@{{ _apigw_truststores_template_filepath }}"
