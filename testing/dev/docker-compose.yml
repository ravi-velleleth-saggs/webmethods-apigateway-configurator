version: "3.2"

networks:
  stack:

services:

  apigateway:
    image: ${REG_APIGATEWAY}${IMAGE_APIGATEWAY}:${TAG_APIGATEWAY}
    ports:
      - "5555:5555"
      - "9072:9072"
    networks:
      - stack

  apigateway_configurator_dev:
    image: ${REG_APIGATEWAY_CONFIGURATOR}webmethods-apigateway-configurator:${TAG_APIGATEWAY_CONFIGURATOR}
    command: ["-v", "apply_configs.yaml"]
    # command: ["apply_configs.yaml","--tags","port_check,change_password,configs_plans"]
    # command: ["-v", "apply_configs.yaml","--tags","port_check,change_password"]
    volumes:
      - ${PWD}/resources/ansible/sagdevops-ansible-common-utils:/ansible/roles/sagdevops-ansible-common-1.0.0-3:ro
      - ${PWD}/resources/ansible/sagdevops-ansible-apigateway:/ansible/roles/sagdevops-ansible-apigateway-1.0.0-4:ro  
    environment: 
      apigw_host: apigateway
      apigw_port: "5555"
      apigw_rest_user: Administrator
      apigw_rest_password: "somethingnew"
      apigw_rest_password_old: "manage"
      apigw_configure_default_ignore_errors: "false"
      apigw_configure_lb_ignore_errors: "false"
      apigw_configure_extended_settings_ignore_errors: "false"
      apigw_configure_packages_ignore_errors: "false"
      apigw_configure_applications: "false"
      apigw_configure_plans: "false"
      apigw_configure_packages: "false"
      apigw_configure_lb: "false"
      apigw_configure_extended_settings: "false"
      apigw_configure_portalgateway: "false"
      apigw_configure_usermgt: "false"
      apigw_configure_archives: "false"
      apigw_configure_aliases: "false"
      apigw_configure_promotions_stages: "false"
      apigw_configure_apis_publish_groups: "false"
      apigw_configure_packages_publish_groups: "false"
      apigw_lb_http_url: "http://localhost"
      apigw_lb_https_url: "https://localhost"
      apigw_lb_websocket_url: "ws://localhost"
      apigw_lb_http_url_alt1: "http://external_access"
      apigw_lb_https_url_alt1: "https://external_access"
      apigw_lb_websocket_url_alt1: "ws://external_access"
      apigw_lb_webapp_url: "http://external_access"
      apigw_portalgateway_gateway_url: "http://apigateway:5555"
      apigw_portalgateway_gateway_username: "Administrator"
      apigw_portalgateway_gateway_password: "somethingnew"
      apigw_portalgateway_portaltype: devportal
      apigw_portalgateway_apiportal_tenant: default
      apigw_portalgateway_apiportal_url: http://apiportal:18101
      apigw_portalgateway_apiportal_username: system
      apigw_portalgateway_apiportal_password: manager
      apigw_portalgateway_devportal_tenant: default
      apigw_portalgateway_devportal_url: "http://apiportal:18101/portal"
      apigw_portalgateway_devportal_username: "Administrator"
      apigw_portalgateway_devportal_password: "manage"
      apigw_aliases_covid_endpoint: http://webmethods-sample-apis-covidreports:7071
      apigw_aliases_bookstore_endpoint: http://webmethods-sample-apis-bookstore:7071
      apigw_aliases_uszip_endpoint: http://webmethods-sample-apis-uszip:7071
      apigw_aliases_sagtours_endpoint: http://webmethods-sample-apis-sagtours:5555
      apigw_ssl_configure_sslconfigs: "true"
      apigw_ssl_keystore_filepath: /opt/softwareag/SAGKeystore.jks
      apigw_ssl_keystore_name: "SSLSAGKeystore"
      apigw_ssl_keystore_description: "My custom keystore for SSL"
      apigw_ssl_keystore_password: "manage"
      apigw_ssl_keystore_keyalias: "1"
      apigw_ssl_keystore_keyalias_password: "manage"
      apigw_ssl_truststore_filepath: /opt/softwareag/SAGTruststore.jks
      apigw_ssl_truststore_description: "My custom truststore"
      apigw_ssl_truststore_password: "manage"
      apigw_saml_configure_samlconfigs: "true"
      apigw_saml_keystore_filepath: /opt/softwareag/SAGKeystore.jks
      apigw_saml_keystore_name: "SAMLSAGKeystore"
      apigw_saml_keystore_description: "My custom keystore for SAML"
      apigw_saml_keystore_password: "manage"
      apigw_saml_keystore_keyalias: "1"
      apigw_saml_keystore_keyalias_password: "manage"
    networks:
      - stack